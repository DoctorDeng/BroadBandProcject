<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<mapper namespace="mapper.BillMapper">
		<select id="selectBillDetailDtoByBillId" parameterType="int" resultType="BillDetailDto">
			SELECT cu.customerId,os.osAccount,os.serverIp,
			cu.customerAccount,ta.tariffName,os.osId ,ta.tariff,ta.timeTariff,ta.timeLong,ta.tariffType,
			(SELECT sum(TIMESTAMPDIFF(SECOND ,loginInTime,loginOutTime)) FROM oslogin WHERE osid = os.osId) as totalTime 
			FROM bill as bi
			INNER JOIN customer as cu
			ON bi.customerId = cu.customerId
			INNER JOIN os
			ON bi.customerId = os.customerId
			INNER JOIN tariff as ta 
			ON ta.tariffId = os.tariffId  
			WHERE bi.billId = #{billId}
		</select>
		
		<select id="selectAllBill" resultType="BillDto">
			SELECT bi.billId,cu.customerName, cu.idNumber, cu.customerAccount,
			(SELECT sum(TIMESTAMPDIFF(SECOND ,loginInTime,loginOutTime)) FROM oslogin WHERE osid in (SELECT osId FROM os WHERE customerId = cu.customerId)) as totalTime,
		 	bi.payWay,bi.payStatus 
			FROM bill as bi 
			INNER JOIN customer as cu ON bi.customerId = cu.customerId 
		</select>
	</mapper>