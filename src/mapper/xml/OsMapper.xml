<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.OsMapper">
	<resultMap type="Os" id="OsGetMapper">
		<id         property="osId"       column="osId"/>
		<result     property="osAccount"  column="osAccount"/>
		<result     property="osPassword" column="osPassword"/>
		<result     property="serverIp"   column="serverIp"/>
		<collection property="Customer"   column="customerId" select=""/>
		<collection property="Tariff"     column="tariffId"   select=""/>
	</resultMap>
	<!-- 测试OS方法的map -->
	<resultMap type="Os" id="OstestMap">
		<id         property="osId"         column="osId"/>
		<result     property="osAccount"    column="osAccount"/>
		<result     property="osPassword"   column="osPassword"/>
		<result     property="serverIp"     column="serverIp"/>
	</resultMap>
	<!-- 查询一条信息，如需使用请注意修改resultMap -->
	<select id="selOneOsByOsid" parameterType="Os" resultMap="OstestMap">
		select * from os where osId=#{osId}
	</select>
	<!-- 通过业务账号去修改信息 -->
	<update id="upOneOsByBussinessId" >
		update os 
		<set>
			<if test="tariffId!=null and tariffId!='' ">
				tariffId=#{tariffId}
			</if>
			<if test="status!=null  and status!='' ">
				status = #{status}
			</if>
		</set> 
		where osId = #{osId}
	</update>
	<!-- 通过业务账号去删除信息 -->
	<delete id="delOneOsByOsId">
		delete from os where osId = #{osId}
	</delete>
	<!-- 查询在业务界面所需要显示的信息 -->
	<select id="selServiceShow" resultType="OsDto">
		SELECT b.bussinessId,c.customerId,c.idNumber,c.customerName,o.osAccount,
               c.`status`,o.serverIp,t.tariffName
               FROM
               bussiness AS b ,
               customer AS c ,
               os AS o ,
               tariff AS t
               WHERE
               b.osId = o.osId AND
               o.customerId = c.customerId AND
               t.tariffId = o.tariffId
			   ORDER BY
               b.bussinessId ASC
	</select>
	<!-- 通过查询身份证进行对Os表的添加功能 -->
	<insert id="addOsInfo">
		insert into os values(null,#{customerId},#{tariffId},#{osAccount},#{osPassword},#{serverIp},1)
	</insert>
	<!-- 通过条件查询 -->
	<select id="selChooseInfo" resultType="OsDto">
		SELECT b.bussinessId,c.customerId,c.idNumber,c.customerName,o.osAccount,
               c.`status`,o.serverIp,t.tariffName
               FROM
               bussiness AS b ,
               customer AS c ,
               os AS o ,
               tariff AS t
              <where>
              <if test="true">
                b.osId = o.osId AND
              </if>
              <if test="true">
                o.customerId = c.customerId AND
              </if>
              <if test="true">
                t.tariffId = o.tariffId
              </if>
              <if test="osAccount!=null and osAccount!=''">
               AND osAccount=#{osAccount}
              </if>
              <if test="serverIp!=null  and serverIp!=''">
               AND serverIp =#{serverIp}
              </if>
              <if test="idNumber!=null  and idNumber!=''">
               AND idNumber=#{idNumber}
              </if>
              <if test="status!=null  and status!=''">
               AND status=#{status}
              </if>
              </where>
	</select>
</mapper>